# Практическая работа: Автоматическое создание Dockerfile

## Цель работы
Научиться быстро создавать Dockerfile для любых проектов по шаблону. Довести процесс до автоматизма, чтобы не задумываться над базовой структурой.

## Задание
Отработать создание Dockerfile на простых примерах (echo) и на своих Java-проектах. Все демонстрации выполняются локально на ноутбуке.

> **Важно:** 
> - [ ] Docker Desktop запущен
> - [ ] Java JDK установлен (версия 11 или выше)
> - [ ] У вас есть свой Java-проект (или используйте пример)
>
> **Время выполнения:** ~1.5 часа
> **Формат:** Демонстрация преподавателю с ноутбука

---

## Шаг 1: Базовый шаблон Dockerfile (Запомнить!)

### [ ] 1.1 Универсальная структура
Запомните этот шаблон — он подходит для 80% проектов:

```dockerfile
# 1. Базовый образ
FROM <образ>:<версия>

# 2. Рабочая директория
WORKDIR /app

# 3. Копирование файлов
COPY . .

# 4. Команда запуска
CMD ["<команда>"]
```

**Что это:** Базовый паттерн для любого Dockerfile  
**Зачем нужно:** Чтобы не думать над структурой каждый раз

### [ ] 1.2 Простой пример с echo
- [ ] Создайте папку `docker-echo-lab`
- [ ] Создайте `Dockerfile`:
```dockerfile
FROM alpine:latest
WORKDIR /app
CMD ["echo", "Hello from Docker!"]
```

- [ ] Соберите и запустите:
```bash
docker build -t echo-test .
docker run --rm echo-test
```

**Проверка понимания:**
- [ ] Выполните команды
- [ ] Убедитесь, что видно "Hello from Docker!"
- [ ] Запомните: `FROM` → `WORKDIR` → `CMD`

---

## Шаг 2: Паттерны для разных задач

### [ ] 2.1 Паттерн: Вывод текста + файл
```dockerfile
FROM alpine:latest
WORKDIR /app
RUN echo "config" > /app/config.txt
CMD ["sh", "-c", "cat /app/config.txt"]
```

**Проверка:**
- [ ] Создайте Dockerfile с этим содержимым
- [ ] Соберите: `docker build -t file-test .`
- [ ] Запустите: `docker run --rm file-test`
- [ ] Должно вывести "config"

### [ ] 2.2 Паттерн: Переменная окружения
```dockerfile
FROM alpine:latest
WORKDIR /app
ENV MY_VAR=DefaultValue
CMD ["sh", "-c", "echo $MY_VAR"]
```

**Проверка:**
- [ ] Соберите: `docker build -t env-test .`
- [ ] Запустите по умолчанию: `docker run --rm env-test`
- [ ] Запустите с переменной: `docker run --rm -e MY_VAR=Custom env-test`
- [ ] Убедитесь, что значение меняется

### [ ] 2.3 Паттерн: Копирование файла с хоста
```dockerfile
FROM alpine:latest
WORKDIR /app
COPY message.txt /app/message.txt
CMD ["cat", "/app/message.txt"]
```

- [ ] Создайте файл `message.txt` с текстом "Hello from host!"
- [ ] Соберите и запустите

**Проверка:**
- [ ] Должно вывести "Hello from host!"

---

## Шаг 3: Шаблон для Java-проектов (Запомнить!)

### [ ] 3.1 Универсальный Dockerfile для Java
Запомните этот шаблон — подходит для любого Java-проекта с JAR:

```dockerfile
# 1. Образ с Java (JRE для запуска)
FROM eclipse-temurin:17-jre-alpine

# 2. Рабочая директория
WORKDIR /app

# 3. Копируем JAR-файл
COPY *.jar /app/app.jar

# 4. Запускаем Java
CMD ["java", "-jar", "app.jar"]
```

**Что это:** Готовый шаблон для 90% Java-проектов  
**Зачем нужно:** Чтобы не писать Dockerfile с нуля каждый раз

### [ ] 3.2 Подготовка Java-проекта
- [ ] Возьмите свой Java-проект (или создайте новый)
- [ ] Убедитесь, что есть `src/Main.java`
- [ ] Соберите JAR локально:
```bash
mkdir -p build
javac -d build src/Main.java
jar cfe app.jar Main -C build .
```

**Проверка:**
- [ ] Запустите локально: `java -jar app.jar`
- [ ] Убедитесь, что работает без Docker

### [ ] 3.3 Создайте Dockerfile для своего проекта
- [ ] Положите `Dockerfile` рядом с `app.jar`
- [ ] Используйте шаблон из 3.1
- [ ] Соберите образ:
```bash
docker build -t my-java-app .
```

- [ ] Запустите контейнер:
```bash
docker run --rm my-java-app
```

**Проверка понимания:**
- [ ] Покажите преподавателю работающий контейнер
- [ ] Вывод должен совпадать с локальным запуском `java -jar`

---

## Шаг 4: Быстрая адаптация под разные проекты

### [ ] 4.1 Если JAR называется иначе
```dockerfile
COPY myapp.jar /app/app.jar
# или
COPY target/*.jar /app/app.jar
```

**Проверка:**
- [ ] Измените имя JAR в своём проекте
- [ ] Обновите `COPY` в Dockerfile
- [ ] Пересоберите и запустите

### [ ] 4.2 Если нужны аргументы запуска
```dockerfile
CMD ["java", "-jar", "-Xmx512m", "app.jar"]
```

**Проверка:**
- [ ] Добавьте параметр памяти или другой флаг
- [ ] Запустите контейнер
- [ ] Убедитесь, что приложение работает

### [ ] 4.3 Если нужен config-файл
```dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY app.jar /app/app.jar
COPY config.properties /app/config.properties
CMD ["java", "-jar", "app.jar"]
```

**Проверка:**
- [ ] Добавьте `config.properties` в проект
- [ ] Обновите Dockerfile
- [ ] Пересоберите и запустите

---

## Шаг 5: Практика — Быстрое создание Dockerfile

### [ ] 5.1 Упражнение на скорость (5 минут)
Создайте Dockerfile для проекта, который:
- [ ] Использует `alpine:latest`
- [ ] Копирует файл `script.sh` в `/app/`
- [ ] Запускает `sh /app/script.sh`

**Шаблон для заполнения:**
```dockerfile
FROM ______
WORKDIR ______
COPY ______
CMD ______
```

**Проверка:**
- [ ] Покажите преподавателю работающий контейнер

### [ ] 5.2 Упражнение на скорость (5 минут)
Создайте Dockerfile для Java-проекта, который:
- [ ] Использует `eclipse-temurin:17-jre-alpine`
- [ ] Копирует `app.jar` в `/app/`
- [ ] Запускает с переменной окружения `APP_ENV`

**Шаблон для заполнения:**
```dockerfile
FROM ______
WORKDIR ______
COPY ______
ENV ______
CMD ______
```

**Проверка:**
- [ ] Запустите с `-e APP_ENV=production`
- [ ] Покажите преподавателю вывод

### [ ] 5.3 Финальное задание — Свой проект
- [ ] Возьмите свой Java-проект
- [ ] Создайте Dockerfile по шаблону (без подглядывания!)
- [ ] Соберите образ
- [ ] Запустите контейнер
- [ ] Покажите преподавателю работу

**Требования:**
- [ ] Dockerfile создан за 3 минуты
- [ ] Образ собирается без ошибок
- [ ] Контейнер запускается и выводит ожидаемый результат

---

## Шаг 6: Чек-лист для самопроверки

### [ ] 6.1 Перед созданием Dockerfile
- [ ] Есть ли базовый образ? (`FROM`)
- [ ] Есть ли рабочая директория? (`WORKDIR`)
- [ ] Копируются ли нужные файлы? (`COPY`)
- [ ] Есть ли команда запуска? (`CMD`)

### [ ] 6.2 Для Java-проектов
- [ ] Образ с JRE, а не JDK? (`eclipse-temurin:17-jre-alpine`)
- [ ] JAR-файл скопирован в образ?
- [ ] Команда `java -jar` указана в `CMD`?

### [ ] 6.3 После создания
- [ ] `docker build` проходит без ошибок?
- [ ] `docker run` выводит ожидаемый результат?
- [ ] Контейнер завершается корректно?

---

## Шпаргалка: Готовые шаблоны Dockerfile

### Шаблон 1: Простой вывод текста
```dockerfile
FROM alpine:latest
WORKDIR /app
CMD ["echo", "Hello!"]
```

### Шаблон 2: С файлом и переменной
```dockerfile
FROM alpine:latest
WORKDIR /app
COPY file.txt /app/file.txt
ENV MY_VAR=value
CMD ["sh", "-c", "echo $MY_VAR && cat /app/file.txt"]
```

### Шаблон 3: Java-проект (базовый)
```dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY *.jar /app/app.jar
CMD ["java", "-jar", "app.jar"]
```

### Шаблон 4: Java + config + env
```dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY *.jar /app/app.jar
COPY config.properties /app/config.properties
ENV APP_ENV=production
CMD ["java", "-jar", "app.jar"]
```

---

## Контрольные вопросы (устный опрос)

### [ ] 7.1 Базовые вопросы
- [ ] Какие 4 обязательные инструкции в Dockerfile?
- [ ] Какой образ использовать для Java-приложений?
- [ ] В чем разница между `RUN` и `CMD`?

### [ ] 7.2 Практические вопросы
- [ ] Как скопировать все файлы из папки в образ?
- [ ] Как передать переменную окружения в контейнер?
- [ ] Что делать, если JAR-файл называется иначе?

### [ ] 7.3 Демонстрация
- [ ] Покажите свой Dockerfile
- [ ] Объясните каждую инструкцию
- [ ] Запустите контейнер и покажите вывод



### [ ] Практикуйтесь на разных проектах
Чем больше проектов вы упакуете, тем быстрее процесс станет автоматическим.

---

## Что вы должны уметь после этой работы

После этой работы вы должны **без подглядывания** создать Dockerfile для:

- [ ] Простого скрипта с `echo`
- [ ] Проекта с копированием файлов
- [ ] Проекта с переменными окружения
- [ ] Java-проекта с JAR-файлом
- [ ] Java-проекта с config-файлом

**Критерий успеха:** Вы смотрите на проект и за 2-3 минуты пишете рабочий Dockerfile.

---

## Формат демонстрации преподавателю

### [ ] Покажите:
1. Исходный код проекта (Java или скрипт)
2. Созданный Dockerfile (объясните каждую строку)
3. Процесс сборки: `docker build -t <name> .`
4. Процесс запуска: `docker run --rm <name>`
5. Вывод контейнера (должен совпадать с ожидаемым)

---
